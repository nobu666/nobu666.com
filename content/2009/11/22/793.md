+++
date = "2009-11-22T17:43:39+09:00"
draft = false
title = "jQuery + jTemplatesを使って、setIntervalで定期的に新しいデータを取得し、要素の上に追加していく方法"
categories = ["javascript"]
+++

はまったので忘れないうちにメモ。

$("#piyopiyo").processTemplate(data) とかやると、id="piyopiyo"な要素の内容が全部置き換わってしまうので、古いデータが消えてしまう。たとえばTwitterクライアントみたいなものを作ろうと思ったら、定期的に新しいtimelineをとってきたら、古いデータを残しつつ、新しいものだけ上に出てきてほしい。

以下のようにすることで、id="piyo"配下のclass="moge"にデータがたまっていく。空のdivを一個用意して、そこにprocessTemplateで新しいデータを入れていく。<a href="http://twitter.com/hideaki_t/">@hideaki_t</a>、ありがとうございました。

[sourcecode lang="javascript"]
&lt;html&gt;
  &lt;head&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-1.3.2.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-jtemplates.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
    $(document).ready(function() {
      hoge.count=1;
      $(&quot;#piyo &gt; .moge &gt; div:first&quot;).setTemplate(&quot;{#foreach $T as r}&lt;div class='hogera'&gt;{$T.r.id}&lt;/div&gt;{#/for}&quot;);
      hoge.show();
      window.setInterval(function(){
        hoge.show();
      }, 5000);
    });
    var hoge = {
      show:function() {
        var data = &quot;[{id:&quot; + hoge.count++ + &quot;}]&quot;;
        var t = $(&quot;#piyo &gt; .moge &gt; div:first&quot;);
        t.after(t.children());
        t.processTemplate(eval(data));
      }
    }
    &lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;piyo&quot;&gt;&lt;div class=&quot;moge&quot;&gt;&lt;div /&gt;&lt;/div&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
```
